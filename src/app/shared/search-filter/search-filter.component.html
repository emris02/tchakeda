<div class="search-filter-container">

  <!-- RIGHT GROUP: Nouveau + Grid/List + Separator + Refresh/Print + Search + Filtre dropdown -->
  <div class="right-group d-flex align-items-center gap-2">

    <!-- Nouveau bouton -->
    <button class="btn btn-primary new-btn" (click)="onAddNew()">
      <span class="new-label">{{ newEntityLabel }}</span>
    </button>

    <!-- Icônes Grid/List (seulement pour Apartments) -->
    <ng-container *ngIf="entityType === 'Apartments'">
      <div class="view-icons d-flex gap-1">
        <button 
          class="btn btn-light small-icon" 
          [class.active]="currentView === 'grid'" 
          (click)="toggleView('grid')" 
          title="Vue grille">
          <i class="fas fa-th-large"></i>
        </button>
        <button 
          class="btn btn-light small-icon" 
          [class.active]="currentView === 'list'" 
          (click)="toggleView('list')" 
          title="Vue liste">
          <i class="fas fa-list"></i>
        </button>
      </div>
    </ng-container>

    <!-- Separator -->
    <div class="separator"></div>

    <!-- Petits boutons Refresh/Print -->
    <div class="small-actions d-flex gap-1">
      <button class="btn btn-light small-icon refresh-icon" (click)="onRefreshClick()" title="Rafraîchir">
        <i class="icon feather icon-rotate-ccw"></i>
      </button>
      <!-- Separator -->
    <div class="separator"></div>
      <button class="btn btn-light small-icon" (click)="onPrint()" title="Imprimer">
        <i class="icon feather icon-printer"></i>
      </button>
    </div>
  
    <!-- Separator -->
    <div class="separator"></div>

<!-- Dropdown de filtrage professionnel -->
<div class="filter-dropdown" [class.open]="filterDropdownOpen">
  
  <!-- Bouton principal avec badge -->
  <button class="filter-toggle btn btn-light" (click)="toggleFilterDropdown()">
    <div class="filter-toggle-content">
      <i class="icon-filter fas fa-filter"></i>
      <span class="filter-label">Filtres</span>
      <span class="filter-badge" *ngIf="activeFilterCount > 0">
        {{ activeFilterCount }}
      </span>
      <i class="icon-chevron fas fa-chevron-down" [class.rotated]="filterDropdownOpen"></i>
    </div>
  </button>

  <!-- Overlay pour fermer en cliquant à l'extérieur -->
  <div class="dropdown-overlay" *ngIf="filterDropdownOpen" (click)="toggleFilterDropdown()"></div>

  <!-- Contenu du dropdown -->
  <div class="dropdown-content" *ngIf="filterDropdownOpen">
    
    <!-- En-tête du dropdown -->
    <div class="dropdown-header">
      <h4>Filtres</h4>
      <button class="btn-close-dropdown" (click)="toggleFilterDropdown()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Liste des filtres -->
    <div class="filters-container">
      
      <!-- Filtre par période -->
      <div class="filter-group">
        <label class="filter-group-label">
          <i class="fas fa-calendar-alt"></i>
          Période
        </label>
        <select class="form-select filter-select" 
                [(ngModel)]="historyFilters.period"
                (ngModelChange)="applyFilters()">
          <option value="">Toutes les périodes</option>
          <option *ngFor="let period of periods" [value]="period">
            {{ period }}
          </option>
        </select>
      </div>

      <!-- Filtre par statut -->
      <div class="filter-group">
        <label class="filter-group-label">
          <i class="fas fa-tag"></i>
          Statut
        </label>
        <div class="filter-options">
          <label class="filter-option" *ngFor="let status of statusOptions">
            <input type="checkbox" 
                   [value]="status.value"
                   [checked]="isStatusSelected(status.value)"
                   (change)="toggleStatusFilter(status.value)">
            <span class="checkmark"></span>
            <span class="option-label">{{ status.label }}</span>
            <span class="status-indicator" [ngClass]="status.value"></span>
          </label>
        </div>
      </div>

      <!-- Filtre par collecteur -->
      <div class="filter-group">
        <label class="filter-group-label">
          <i class="fas fa-user-tie"></i>
          Collecteur
        </label>
        <select class="form-select filter-select" 
                [(ngModel)]="historyFilters.collector"
                (ngModelChange)="applyFilters()">
          <option value="">Tous les collecteurs</option>
          <option *ngFor="let collector of collectors" [value]="collector.id">
            {{ collector.fullName }}
          </option>
        </select>
      </div>

      <!-- Filtre par propriétaire -->
      <div class="filter-group">
        <label class="filter-group-label">
          <i class="fas fa-building"></i>
          Propriétaire
        </label>
        <select class="form-select filter-select" 
                [(ngModel)]="historyFilters.owner"
                (ngModelChange)="applyFilters()">
          <option value="">Tous les propriétaires</option>
          <option *ngFor="let owner of owners" [value]="owner.id">
            {{ owner.name }}
          </option>
        </select>
      </div>

      <!-- Filtre par bâtiment -->
      <div class="filter-group">
        <label class="filter-group-label">
          <i class="fas fa-home"></i>
          Bâtiment
        </label>
        <select class="form-select filter-select" 
                [(ngModel)]="historyFilters.building"
                (ngModelChange)="applyFilters()">
          <option value="">Tous les bâtiments</option>
          <option *ngFor="let building of buildings" [value]="building.id">
            {{ building.name }}
          </option>
        </select>
      </div>

      <!-- Filtre par montant -->
      <div class="filter-group">
        <label class="filter-group-label">
          <i class="fas fa-money-bill-wave"></i>
          Montant
        </label>
        <div class="amount-filter">
          <div class="amount-inputs">
            <input type="number" 
                   class="form-input amount-input"
                   placeholder="Min"
                   [(ngModel)]="historyFilters.amountMin"
                   (ngModelChange)="applyFilters()">
            <span class="amount-separator">-</span>
            <input type="number" 
                   class="form-input amount-input"
                   placeholder="Max"
                   [(ngModel)]="historyFilters.amountMax"
                   (ngModelChange)="applyFilters()">
          </div>
          <span class="amount-currency">XOF</span>
        </div>
      </div>

      <!-- Filtre par date -->
      <div class="filter-group">
        <label class="filter-group-label">
          <i class="fas fa-clock"></i>
          Date de paiement
        </label>
        <div class="date-filter">
          <input type="date" 
                 class="form-input date-input"
                 [(ngModel)]="historyFilters.startDate"
                 (ngModelChange)="applyFilters()">
          <span class="date-separator">au</span>
          <input type="date" 
                 class="form-input date-input"
                 [(ngModel)]="historyFilters.endDate"
                 (ngModelChange)="applyFilters()">
        </div>
      </div>

    </div>

    <!-- Pied du dropdown avec actions -->
    <div class="dropdown-footer">
      <div class="filter-stats" *ngIf="activeFilterCount > 0">
        <i class="fas fa-info-circle"></i>
        {{ filteredPayments.length }} résultat(s) sur {{ payments.length }}
      </div>
      <div class="filter-actions">
        <button class="btn btn-outline btn-sm" (click)="clearFilters()">
          <i class="fas fa-eraser"></i>
          Réinitialiser
        </button>
        <button class="btn btn-primary btn-sm" (click)="toggleFilterDropdown()">
          <i class="fas fa-check"></i>
          Appliquer
        </button>
      </div>
    </div>

  </div>
</div>
      <!-- Separator -->
    <div class="separator"></div>

    <!-- Barre de recherche -->
    <div class="search-box">
      <input
        [placeholder]="placeholder"
        [formControl]="searchControl"
        type="text"
        class="search-input"
        aria-label="Recherche"
      />
      <i class="icon feather icon-search search-icon"></i>
    </div>

  </div>

</div>