<div class="page-container">
  <div class="page-header">
    <button class="btn btn-light back-btn" (click)="cancel()" title="Retour à la liste">
      <i class="fas fa-arrow-left"></i> Retour
    </button>
    <h4 class="page-title">Créer un appartement</h4>
  </div>

<div class="content-container">
  <form #buildingForm="ngForm" (ngSubmit)="create()" class="form-card building-grid">

    <!-- Nom du bâtiment -->
    <div class="form-group">
      <input type="text" id="name" [(ngModel)]="form.name" name="name" #nameCtrl="ngModel" class="underline-input" required placeholder="Nom du bâtiment" [class.invalid]="nameCtrl.invalid && (nameCtrl.touched || buildingForm.submitted)" />
      <label for="name" class="label">
        <i class="fas fa-building"></i>
        Nom du bâtiment
      </label>
      <div class="error" *ngIf="errors.name">{{ errors.name }}</div>
      <div class="error" *ngIf="nameCtrl.invalid && (nameCtrl.touched || buildingForm.submitted)">
        Le nom du bâtiment est requis.
      </div>
    </div>

    <!-- Type de bâtiment -->
    <div class="form-group">
      <select id="type" [(ngModel)]="form.type" name="type" #typeCtrl="ngModel" class="underline-input" required (change)="onTypeChange($event)" [class.invalid]="typeCtrl.invalid && (typeCtrl.touched || buildingForm.submitted)">
        <option [ngValue]="null">Sélectionner...</option>
        <option value="résidentiel">Résidentiel</option>
        <option value="commercial">Commercial</option>
        <option value="mixte">Mixte</option>
        <option value="studio">Studio</option>
        <option value="apartment">Appartement</option>
        <option value="hotel">Hôtel</option>
        <option value="villa">Villa</option>
        <option value="autre">Autre...</option>
      </select>
      <label for="type" class="label">
        <i class="fas fa-th-large"></i>
        Type de bâtiment
      </label>
      <input *ngIf="isCustomType" type="text" id="customType" [(ngModel)]="form.customType" name="customType" class="underline-input" placeholder="Saisir le type" />
      <div class="error" *ngIf="typeCtrl.invalid && (typeCtrl.touched || buildingForm.submitted)">Type requis.</div>
      <div class="error" *ngIf="errors.type">{{ errors.type }}</div>
      <div class="error" *ngIf="errors.customType">{{ errors.customType }}</div>
    </div>

    <!-- Nombre d'étages -->
    <div class="form-group">
      <input type="number" id="floors" [(ngModel)]="form.floors" name="floors" #floorsCtrl="ngModel" class="underline-input" required min="1" placeholder="Nombre d'étages" [class.invalid]="floorsCtrl.invalid && (floorsCtrl.touched || buildingForm.submitted)" />
      <label for="floors" class="label">
        <i class="fas fa-layer-group"></i>
        Nombre d'étages
      </label>
      <div class="error" *ngIf="floorsCtrl.invalid && (floorsCtrl.touched || buildingForm.submitted)">Nombre d'étages requis.</div>
      <div class="error" *ngIf="errors.floors">{{ errors.floors }}</div>
    </div>

    <!-- Nombre d'appartements -->
    <div class="form-group">
      <input type="number" id="apartments" [(ngModel)]="form.apartments" name="apartments" #apartmentsCtrl="ngModel" class="underline-input" required min="1" placeholder="Nombre d'appartements" [class.invalid]="apartmentsCtrl.invalid && (apartmentsCtrl.touched || buildingForm.submitted)" />
      <label for="apartments" class="label">
        <i class="fas fa-home"></i>
        Nombre d'appartements
      </label>
      <div class="error" *ngIf="apartmentsCtrl.invalid && (apartmentsCtrl.touched || buildingForm.submitted)">Nombre d'appartements requis.</div>
      <div class="error" *ngIf="errors.apartments">{{ errors.apartments }}</div>
    </div>

    <!-- Adresse -->
    <div class="form-group">
      <input type="text" id="address" [(ngModel)]="form.address" name="address" #addressCtrl="ngModel" class="underline-input" required placeholder="Adresse" [class.invalid]="addressCtrl.invalid && (addressCtrl.touched || buildingForm.submitted)" />
      <label for="address" class="label">
        <i class="fas fa-map-marker-alt"></i>
        Adresse
      </label>
      <div class="error" *ngIf="addressCtrl.invalid && (addressCtrl.touched || buildingForm.submitted)">Adresse requise.</div>
      <div class="error" *ngIf="errors.address">{{ errors.address }}</div>
    </div>

    <!-- Ville -->
    <div class="form-group">
      <input type="text" id="city" [(ngModel)]="form.city" name="city" #cityCtrl="ngModel" class="underline-input" required placeholder="Ville" [class.invalid]="cityCtrl.invalid && (cityCtrl.touched || buildingForm.submitted)" />
      <label for="city" class="label">
        <i class="fas fa-city"></i>
        Ville
      </label>
      <div class="error" *ngIf="cityCtrl.invalid && (cityCtrl.touched || buildingForm.submitted)">Ville requise.</div>
      <div class="error" *ngIf="errors.city">{{ errors.city }}</div>
    </div>

    <!-- Quartier / Région -->
    <div class="form-group">
      <input type="text" id="region" [(ngModel)]="form.region" name="region" #regionCtrl="ngModel" class="underline-input" required placeholder="Quartier / Région" [class.invalid]="regionCtrl.invalid && (regionCtrl.touched || buildingForm.submitted)" />
      <label for="region" class="label">
        <i class="fas fa-map-signs"></i>
        Quartier / Région
      </label>
      <div class="error" *ngIf="regionCtrl.invalid && (regionCtrl.touched || buildingForm.submitted)">Quartier / Région requis.</div>
      <div class="error" *ngIf="errors.region">{{ errors.region }}</div>
    </div>

    <!-- Date de construction -->
    <div class="form-group">
      <input type="date" id="constructionDate" [(ngModel)]="form.constructionDate" name="constructionDate" #constructionCtrl="ngModel" class="underline-input" required placeholder="Date de construction" [class.invalid]="constructionCtrl.invalid && (constructionCtrl.touched || buildingForm.submitted)" />
      <label for="constructionDate" class="label">
        <i class="fas fa-calendar-alt"></i>
        Date de construction
      </label>
      <div class="error" *ngIf="constructionCtrl.invalid && (constructionCtrl.touched || buildingForm.submitted)">Date de construction requise.</div>
      <div class="error" *ngIf="errors.constructionDate">{{ errors.constructionDate }}</div>
    </div>

    <!-- Propriétaire avec possibilité de créer -->
    <div class="form-group full-width" style="display: flex; align-items: center; gap: 10px;">
      <div style="flex: 1; position: relative;">
        <select id="ownerId" [(ngModel)]="form.ownerId" name="ownerId" #ownerCtrl="ngModel" class="underline-input" required [class.invalid]="ownerCtrl.invalid && (ownerCtrl.touched || buildingForm.submitted)">
          <option [ngValue]="null">Sélectionner...</option>
          <option *ngFor="let owner of owners" [ngValue]="owner.id">{{ owner.fullName }}</option>
        </select>
        <label for="ownerId" class="label">
          <i class="fas fa-user-tie"></i>
          Propriétaire
        </label>
        <div class="error" *ngIf="ownerCtrl.invalid && (ownerCtrl.touched || buildingForm.submitted)">Propriétaire requis.</div>
        <div class="error" *ngIf="errors.ownerId">{{ errors.ownerId }}</div>
      </div>
      <button type="button" class="btn btn-outline-primary btn-sm" (click)="openOwnerDialog()">
        <i class="fas fa-user-plus"></i> Nouveau propriétaire
      </button>
    </div>
  </form>
</div>
    <div class="action-bar">
      <div class="form-actions">
        <button type="button" class="btn btn-light btn-cancel" (click)="cancel()">Annuler</button>
        <button type="submit" class="btn btn-primary btn-save">Créer</button>
      </div>
    </div>
