<div class="page-container add-page">
  
      <button class="btn back-btn" (click)="cancel()" title="Retour à la liste">
        <i class="fas fa-chevron-left"></i>
        <span class="back-label">Locations</span>
      </button>
      <h4 class="page-title">Créer une location</h4>
    </div>
    <div class="header-right">
      <!-- action slot: place add/list buttons here on listing pages -->

  <div class="content-container">
  <form #rentalForm="ngForm" (ngSubmit)="create(rentalForm)" class="form-card rental-grid">
    <div class="form-error-summary" *ngIf="hasErrors">
      <i class="fas fa-exclamation-circle"></i>
      Veuillez corriger les champs requis ci-dessous.
    </div>
    
    <!-- Propriétaire -->
    <div class="form-group">
      <div class="input-with-button">
        <select id="ownerId" [(ngModel)]="form.ownerId" name="ownerId" class="underline-input" (change)="onOwnerChange()" required>
          <option [ngValue]="0">Sélectionner...</option>
          <option *ngFor="let owner of owners" [ngValue]="owner.id">{{ owner.FullName }}</option>
        </select>
        <label for="ownerId" class="label">
          <i class="fas fa-user-tie"></i>
          Propriétaire
        </label>
        <button type="button" class="btn btn-outline-primary btn-sm" (click)="goToNewOwner()" title="Ajouter un propriétaire">
          <i class="fas fa-user-plus"></i> Nouveau propriétaire
        </button>
      </div>
      <div class="error" *ngIf="errors['ownerId']">{{ errors['ownerId'] }}</div>
    </div>

    <!-- Bâtiment -->
    <div class="form-group">
      <div class="input-with-button">
        <select id="buildingId" [(ngModel)]="form.buildingId" name="buildingId" class="underline-input" (change)="onBuildingChange()" required>
          <option [ngValue]="0">Sélectionner...</option>
          <option *ngFor="let building of filteredBuildings" [ngValue]="building.id">{{ building.name }}</option>
        </select>
        <label for="buildingId" class="label">
          <i class="fas fa-building"></i>
          Bâtiment
        </label>
        <button type="button" class="btn btn-outline-primary btn-sm" (click)="goToNewBuilding()" title="Ajouter un bâtiment">
          <i class="fas fa-plus"></i> Nouveau bâtiment
        </button>
      </div>
      <div class="error" *ngIf="errors['buildingId']">{{ errors['buildingId'] }}</div>
    </div>

    <!-- Appartement -->
    <div class="form-group">
      <div class="input-with-button">
        <select id="apartmentId" [(ngModel)]="form.apartmentId" name="apartmentId" class="underline-input" required (change)="onApartmentChange()">
          <option [ngValue]="0">Sélectionner...</option>
          <option *ngFor="let apartment of filteredApartments" [ngValue]="apartment.id">{{ apartment.name }}</option>
        </select>
        <label for="apartmentId" class="label">
          <i class="fas fa-home"></i>
          Appartement
        </label>
        <button type="button" class="btn btn-outline-primary btn-sm" (click)="goToNewApartment()" title="Ajouter un appartement">
          <i class="fas fa-plus"></i> Nouvel appartement
        </button>
      </div>
      <div class="error" *ngIf="errors['apartmentId']">{{ errors['apartmentId'] }}</div>
    </div>

    <!-- Locataire -->
        <div class="form-group">
          <div class="input-with-button">           
              <select id="tenantId" [(ngModel)]="form.tenantId" name="tenantId" class="underline-input">
                <option [ngValue]="null">Sélectionner un locataire...</option>
                <option *ngFor="let tenant of tenants" [ngValue]="tenant.id">{{ tenant.fullName }}</option>
              </select>
              <label for="tenantId" class="label">
                <i class="fas fa-user"></i>
                Locataire
              </label>           
            <div class="error" *ngIf="errors['tenantId']"><i class="fas fa-exclamation-circle"></i> {{ errors['tenantId'] }}</div>
            <button type="button" class="btn btn-outline-primary btn-sm" (click)="openTenantDialog()" title="Ajouter un locataire">
              <i class="fas fa-user-plus"></i> Nouveau locataire
            </button>
          </div>
        </div>

    <!-- Mensualité -->
    <div class="form-group">
      <div class="input-with-button">
        <input type="number" id="price" [(ngModel)]="form.price" name="price" class="underline-input" required min="1000" step="1000" placeholder="Loyer mensuel (CFA)" />
        <label for="price" class="label">
          <i class="fas fa-money-bill-wave"></i>
          Loyer mensuel (CFA)
        </label>
      </div>
      <div class="error" *ngIf="errors['price']">{{ errors['price'] }}</div>
    </div>

    <!-- Caution toggle + field -->
    <div class="form-group">
      <label class="checkbox-inline">
        <input type="checkbox" [(ngModel)]="showDeposit" (ngModelChange)="onShowDepositChange($event)" name="showDeposit" /> Avec caution
      </label>
    </div>

    <div class="form-group" *ngIf="showDeposit">
      <input type="number" id="deposit" [(ngModel)]="form.deposit" name="deposit" class="underline-input" min="0" step="1000" placeholder="Caution (CFA)" />
      <label for="deposit" class="label">
        <i class="fas fa-hand-holding-dollar"></i>
        Caution (CFA)
      </label>
      <div class="error" *ngIf="errors['deposit']">{{ errors['deposit'] }}</div>
    </div>
    <!-- Recouvreur -->
    <div class="form-group full-width">
      <div class="input-with-button">
        <select id="collectorId" [(ngModel)]="form.collectorId" name="collectorId" class="underline-input" required>
          <option [ngValue]="0">Sélectionner...</option>
          <option *ngFor="let collector of collectors" [ngValue]="collector.id">{{ collector.fullName }}</option>
        </select>
        <label for="collectorId" class="label">
          <i class="fas fa-user-shield"></i>
          Recouvreur
        </label>
        <div class="error" *ngIf="errors['collectorId']"><i class="fas fa-exclamation-circle"></i> {{ errors['collectorId'] }}</div>
        <button type="button" class="btn btn-outline-primary btn-sm" (click)="openNewCollectorDialog()" title="Ajouter un recouvreur">
          <i class="fas fa-user-plus"></i> Nouveau recouvreur
        </button>
      </div>
      <!-- <div class="error" *ngIf="errors['collectorId']">{{ errors['collectorId'] }}</div> -->
    </div>

    <!-- Date début -->
    <div class="form-group">
      <input type="date" id="startDate" [(ngModel)]="form.startDate" name="startDate" class="underline-input" required placeholder="Date début" />
      <label for="startDate" class="label">
        <i class="fas fa-calendar-alt"></i>
        Date début
      </label>
      <div class="error" *ngIf="errors['startDate']">{{ errors['startDate'] }}</div>
    </div>

    <!-- Date fin -->
    <div class="form-group">
      <input type="date" id="endDate" [(ngModel)]="form.endDate" name="endDate" class="underline-input" required placeholder="Date fin" />
      <label for="endDate" class="label">
        <i class="fas fa-calendar-check"></i>
        Date fin
      </label>
      <div class="error" *ngIf="errors['endDate']">{{ errors['endDate'] }}</div>
    </div>
    </form>
</div>
<!-- Actions -->
      <div class="action-bar">
        <div class="form-actions">
            <div class="action-error-summary" *ngIf="hasErrors">
              <i class="fas fa-exclamation-circle"></i>
              Veuillez corriger les champs requis ci-dessous.
            </div>
            <div class="action-buttons">
              <button type="button" class="btn btn-light btn-cancel" (click)="cancel()">Annuler</button>
              <button type="button" class="btn btn-primary btn-save" (click)="create(rentalForm)">Créer</button>
            </div>
          </div>
      </div>
    
