<div class="page-container owners-payments">
  <div class="card">
    <div class="card-body d-flex align-items-center justify-content-between">
      <div class="filter-panel d-flex align-items-center">
        <div class="form-group">
          <select class="underline-input period-select me-2" [(ngModel)]="selectedOwnerId" (change)="computeOwnerRentals(selectedOwnerId); applyFilters()">
            <option [ngValue]="undefined">Tous les propriétaires</option>
            <option *ngFor="let o of owners" [ngValue]="o.id">{{ o.name }}</option>
          </select>
          <label class="label">Propriétaire</label>
        </div>

        <div class="form-group">
          <select class="underline-input period-select me-2" [(ngModel)]="selectedPeriod" (change)="applyFilters()">
            <option value="">Toutes les périodes</option>
            <option *ngFor="let p of periods" [value]="p">{{ p }}</option>
          </select>
          <label class="label">Période</label>
        </div>

        <div class="form-group">
          <input class="underline-input search-input me-2" placeholder=" " [(ngModel)]="searchTerm" (input)="applyFilters()" />
          <label class="label">Rechercher</label>
        </div>
        <button class="btn btn-filter btn-outline-primary" (click)="applyFilters()"><i class="fas fa-search"></i> Filtrer</button>
      </div>

      <div>
        <!-- reserved for actions -->
      </div>
    </div>
  </div>

  <!-- Owner summary (distinct from recouvreurs view) -->
  <div class="summary-card card mt-3">
    <div class="card-body d-flex align-items-center justify-content-between">
      <div>
        <h6>Total collecté</h6>
        <div class="summary-amount">{{ totalCollected | number:'1.0-0' }} Fcfa</div>
        <div class="muted">{{ paymentsCount }} paiements</div>
      </div>

      <div class="methods">
        <h6>Méthodes</h6>
        <div class="method-list d-flex">
          <span *ngFor="let m of methodBreakdown" class="method-chip">
            {{ m.method }} — {{ m.amount | number:'1.0-0' }} Fcfa
          </span>
        </div>
      </div>

      <div class="periods">
        <h6>Périodes</h6>
        <div class="period-list">
          <div *ngFor="let pt of periodTotals" class="period-row">{{ pt.period }} : {{ pt.amount | number:'1.0-0' }} Fcfa</div>
        </div>
      </div>
    </div>
  </div>

  <div class="content-container mt-3">
    <div class="table-responsive">
      <table class="table table-hover payments-table">
        <thead>
          <tr>
            <th>Bâtiment</th>
            <th>Mensualité</th>
            <th>Date de paiement</th>
            <th>Mode</th>
            <th>Montant payé</th>
            <th>Locataire</th>
            <th>Recouvreur</th>
            <th>Appartement</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let p of filteredPayments">
            <td>{{ p.buildingName }}</td>
            <td>{{ p.amount | number:'1.0-0' }} Fcfa</td>
            <td>{{ p.paymentDate | date:'dd/MM/yyyy' }}</td>
            <td>{{ p.paymentMethod }}</td>
            <td>{{ p.amount | number:'1.0-0' }} Fcfa</td>
            <td>{{ p.tenantName || '-' }}</td>
            <td>{{ p.collectorName || '-' }}</td>
            <td>{{ p.apartmentName || '-' }}</td>
          </tr>
          <tr *ngIf="filteredPayments.length === 0"><td colspan="8" class="text-center">Aucun paiement enregistré</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

