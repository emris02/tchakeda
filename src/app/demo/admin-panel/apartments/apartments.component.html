<div class="content-container">
  <!-- Page header -->
  <div class="apartments-page-header d-flex align-items-center justify-content-between flex-wrap">
    <h4 class="page-title">Appartements</h4>

    <div class="header-controls d-flex align-items-center gap-2">
      <app-search-filter
        [entityType]="'Apartments'"
        [placeholder]="'Rechercher par nom, adresse, ville...'"
        (searchChange)="onSearch($event)"
        (filterChange)="onFilter($event)"
        (refresh)="onRefreshClicked()"
        (print)="onPrintClicked()"
        (addNew)="onAddNewClicked()"
        (viewChange)="onViewChange($event)"
      ></app-search-filter>
    </div>
  </div>


  <!-- ============================= -->
  <!--        VUE LISTE             -->
  <!-- ============================= -->
  <table class="table apartments-table" *ngIf="viewMode === 'list'">
  <thead>
    <tr>
      <th>Nom de l'appartement</th>
      <th>Adresse</th>
      <th>Ville</th>
      <th>Région</th>
      <th>Locataire</th>
      <th>Mensualité</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let apartment of displayedApartments" 
        (click)="goToDetail(apartment)" 
        class="clickable-row">
      <td>{{ apartment.name }}</td>
      <td>{{ apartment.address }}</td>
      <td>{{ apartment.city }}</td>
      <td>{{ apartment.region }}</td>
      <td>{{ getTenantDisplay(apartment) }}</td>
      <td>
        <span *ngIf="apartment.mention">{{ apartment.mention | number }} FCFA</span>
      </td>
    </tr>
  </tbody>
  </table>


  <!-- Pagination seulement en LIST -->
  <div class="list-pagination" *ngIf="viewMode === 'list'">
    <app-pagination
      [page]="page"
      [pageSize]="pageSize"
      [total]="total"
      (pageChange)="onPageChange($event)"
      (pageSizeChange)="onPageSizeChange($event)">
    </app-pagination>
  </div>


  <!-- ============================= -->
  <!--        VUE GRID              -->
  <!-- ============================= -->
  <div *ngIf="viewMode === 'grid'">
    <div class="apartments-grid">

      <div class="apartment-card clickable-row"
          *ngFor="let apartment of displayedApartments"
          (click)="goToDetail(apartment)">

        <!-- Image / Carousel -->
        <div class="card-image card-image-square"
            (mouseenter)="apartment._showOverlay = true"
            (mouseleave)="apartment._showOverlay = false">

          <!-- Title badge -->
          <div class="card-name-badge" [title]="apartment.name">
            {{ apartment.name || ('Appartement ' + (apartment.id || '')) }}
          </div>

          <div class="carousel-wrapper">

            <!-- Left arrow -->
            <button type="button" class="carousel-arrow left"
                    (click)="$event.stopPropagation(); apartment._carouselIndex = (apartment._carouselIndex > 0 ? apartment._carouselIndex - 1 : (apartment.rooms || 1) - 1)">
              <i class="fas fa-chevron-left"></i>
            </button>

            <!-- Main Image -->
            <img [src]="apartment.images?.[apartment._carouselIndex || 0] || 'assets/images/gallery-grid/img-grd-gal-1.jpg'"
                [alt]="apartment.roomLabels?.[apartment._carouselIndex || 0] || 'Pièce ' + ((apartment._carouselIndex || 0)+1)"
                class="card-img-cover" />

            <!-- Right arrow -->
            <button type="button" class="carousel-arrow right"
                    (click)="$event.stopPropagation(); apartment._carouselIndex = (apartment._carouselIndex < (apartment.rooms || 1) - 1 ? (apartment._carouselIndex || 0) + 1 : 0)">
              <i class="fas fa-chevron-right"></i>
            </button>

            <!-- Indicator -->
            <div class="carousel-indicator">
              {{ (apartment._carouselIndex || 0) + 1 }}/{{ apartment.rooms || apartment.images?.length || 1 }}
            </div>

            <!-- Overlay -->
            <div class="card-overlay-info left" *ngIf="apartment._showOverlay">
              <div class="overlay-room-label">
                <div class="room-title">
                  {{ getCurrentRoomLabel(apartment) }}
                </div>
                <div class="room-desc">
                  {{ getCurrentRoomDescription(apartment) }}
                </div>
              </div>

              <div class="overlay-details">
                <div><i class="fas fa-map-marker-alt"></i> {{ apartment.address }}, {{ apartment.city }}</div>
                <div><i class="fas fa-door-open"></i> {{ apartment.rooms }} pièces</div>
                <div><i class="fas fa-building"></i> Type: {{ apartment.type === 'autre' ? apartment.customType : apartment.type }}</div>
                <div><i class="fas fa-user"></i> Locataire: {{ getTenantDisplay(apartment) }}</div>
              </div>

            </div>

          </div>

        </div>
      </div>

    </div>
    </div>
  
</div>