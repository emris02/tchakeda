<div class="page-container">
  
    <button class="btn  back-btn" (click)="back()">
      &lt;
    </button>
    <h4 class="page-title">Détail du locataire</h4>

  <!-- Modale de suppression -->
  <div *ngIf="showDeleteConfirm" class="modal-overlay">
    <div class="modal-card">
      <h5>Confirmer la suppression</h5>
      <p>Voulez-vous vraiment supprimer ce locataire ? Cette action est irréversible.</p>
      <div class="form-actions">
        <button type="button" class="btn btn-light" (click)="showDeleteConfirm = false">Annuler</button>
        <button type="button" class="btn btn-danger" (click)="deleteTenant()">Supprimer</button>
      </div>
    </div>
  </div>

  <!-- Modale d'abandon de location -->
  <div *ngIf="showAbandonmentModal" class="modal-overlay">
    <div class="modal-card large">
      <h5>Abandonner la location</h5>
      <p class="warning-text">
        <i class="fas fa-exclamation-triangle"></i>
        Vous êtes sur le point d'abandonner votre location. Veuillez lire attentivement les conditions ci-dessous.
      </p>
      
      <div class="abandonment-conditions">
        <h6>Conditions d'abandon :</h6>
        <ul>
          <li>Vous devez payer tous les loyers impayés jusqu'à la date d'abandon</li>
          <li>Vous devez restituer l'appartement dans son état initial (sans dégradation)</li>
          <li>Vous devez régler toutes les factures impayées (eau, électricité, etc.)</li>
          <li>L'abandon prend effet immédiatement après confirmation</li>
          <li>Vous perdrez tous vos droits sur l'appartement à partir de la date d'abandon</li>
        </ul>
      </div>

      <div class="form-group">
        <label for="abandonmentReason">Raison de l'abandon <span class="required">*</span></label>
        <textarea 
          id="abandonmentReason" 
          [(ngModel)]="abandonmentReason" 
          class="form-control" 
          rows="3" 
          placeholder="Veuillez expliquer la raison de votre abandon..."
          required></textarea>
        <div class="error" *ngIf="errors.abandonmentReason">
          <i class="fas fa-exclamation-circle"></i> {{ errors.abandonmentReason }}
        </div>
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" [(ngModel)]="acceptAbandonmentConditions" />
          J'accepte les conditions d'abandon et je confirme avoir lu et compris toutes les clauses
        </label>
        <div class="error" *ngIf="errors.abandonmentConditions">
          <i class="fas fa-exclamation-circle"></i> {{ errors.abandonmentConditions }}
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-light" (click)="closeAbandonmentModal()">Annuler</button>
        <button type="button" class="btn btn-danger" (click)="confirmAbandonment()" [disabled]="!acceptAbandonmentConditions || !abandonmentReason">
          Confirmer l'abandon
        </button>
      </div>
    </div>
  </div>

  <!-- Formulaire d'édition du locataire -->
  <form *ngIf="editMode" (ngSubmit)="save()" class="form-card">
    <!-- Section infos principales -->
    <div class="card-header">
      <h5>Informations du locataire</h5>
      <div class="action-buttons">
        <button class="action-btn save" type="submit" title="Enregistrer les modifications">
          <i class="fas fa-check"></i>
        </button>
      </div>
    </div>
    
    <div class="tenant-form-content">
      <!-- Photo et informations personnelles -->
      <div class="tenant-profile-section">
        <div class="tenant-photo-upload">
          <div class="tenant-photo-container">
            <img *ngIf="form.identityImage" [src]="form.identityImage" alt="Photo d'identité" class="tenant-photo" />
            <div *ngIf="!form.identityImage" class="tenant-avatar">
              <i class="fas fa-user"></i>
            </div>
          </div>
          <div class="image-upload-controls">
            <input type="file" id="identityImage" accept="image/*" (change)="onIdentityImageSelected($event)" class="file-input" />
            <label for="identityImage" class="btn btn-outline-primary btn-sm">
              <i class="fas fa-camera"></i> Changer la photo
            </label>
            <div class="error" *ngIf="errors.identityImage">{{ errors.identityImage }}</div>
          </div>
        </div>

        <div class="tenant-info-grid">
              <div class="form-group">
                <div class="input-container">
                  <input type="text" id="fullName" [(ngModel)]="form.fullName" name="fullName" class="underline-input" required placeholder=" " />
                  <label for="fullName" class="label">
                    <i class="fas fa-user"></i>
                    Nom complet <span class="required">*</span>
                  </label>
                </div>
                <div class="error" *ngIf="errors.fullName">
                  <i class="fas fa-exclamation-circle"></i> {{ errors.fullName }}
                </div>
              </div>

          <div class="form-group">
            <div class="input-container">
              <input type="text" id="country" [(ngModel)]="form.country" name="country" class="underline-input" required placeholder=" " />
              <label for="country" class="label">
                <i class="fas fa-globe"></i>
                Pays <span class="required">*</span>
              </label>
            </div>
            <div class="error" *ngIf="errors.country">
              <i class="fas fa-exclamation-circle"></i> {{ errors.country }}
            </div>
          </div>

          <div class="form-group">
            <div class="input-container">
              <input type="text" id="address" [(ngModel)]="form.address" name="address" class="underline-input" required placeholder=" " />
              <label for="address" class="label">
                <i class="fas fa-map-marker-alt"></i>
                Adresse <span class="required">*</span>
              </label>
            </div>
            <div class="error" *ngIf="errors.address">
              <i class="fas fa-exclamation-circle"></i> {{ errors.address }}
            </div>
          </div>

          <div class="form-group">
            <div class="input-container">
              <input type="text" id="phone" [(ngModel)]="form.phone" name="phone" class="underline-input" required placeholder=" " />
              <label for="phone" class="label">
                <i class="fas fa-phone"></i>
                Téléphone <span class="required">*</span>
              </label>
            </div>
            <div class="error" *ngIf="errors.phone">
              <i class="fas fa-exclamation-circle"></i> {{ errors.phone }}
            </div>
          </div>

          <div class="form-group">
            <div class="input-container">
              <input type="text" id="emergencyContact" [(ngModel)]="form.emergencyContact" name="emergencyContact" class="underline-input" required placeholder=" " />
              <label for="emergencyContact" class="label">
                <i class="fas fa-phone"></i>
                Contact d'urgence <span class="required">*</span>
              </label>
            </div>
            <div class="error" *ngIf="errors.emergencyContact">
              <i class="fas fa-exclamation-circle"></i> {{ errors.emergencyContact }}
            </div>
          </div>

          <div class="form-group">
            <div class="input-container">
              <input type="email" id="email" [(ngModel)]="form.email" name="email" class="underline-input" placeholder=" " />
              <label for="email" class="label">
                <i class="fas fa-envelope"></i>
                Email
              </label>
            </div>
            <div class="error" *ngIf="errors.email">
              <i class="fas fa-exclamation-circle"></i> {{ errors.email }}
            </div>
          </div>

          <div class="form-group">
            <div class="input-container">
              <input type="text" id="profession" [(ngModel)]="form.profession" name="profession" class="underline-input" placeholder=" " />
              <label for="profession" class="label">
                <i class="fas fa-briefcase"></i>
                Profession
              </label>
            </div>
            <div class="error" *ngIf="errors.profession">
              <i class="fas fa-exclamation-circle"></i> {{ errors.profession }}
            </div>
          </div>
          <div class="form-group">
          <div class="input-container">
            <select id="maritalStatus" [(ngModel)]="form.maritalStatus" name="maritalStatus" 
                    class="underline-input">
              <option value=""></option>
              <option value="Célibataire">Célibataire</option>
              <option value="Marié(e)">Marié(e)</option>
              <option value="Divorcé(e)">Divorcé(e)</option>
              <option value="Veuf(ve)">Veuf(ve)</option>
            </select>
            <label for="maritalStatus" class="label">
              <i class="fas fa-heart input-icon"></i>
              Situation matrimoniale <span class="required">*</span>
            </label>
          </div>
            <div class="error" *ngIf="errors.maritalStatus">
              <i class="fas fa-exclamation-circle"></i> {{ errors.maritalStatus }}
            </div>
          </div>
        </div>
      </div>

      <!-- Sélection du bâtiment et appartement -->
      <div class="location-section">
        <h6>Localisation</h6>
        <div class="location-grid">
          <div class="form-group">
            <div class="input-container">
              <select id="buildingId" [(ngModel)]="form.buildingId" name="buildingId" class="underline-input" (change)="onBuildingChange()" required>
                <option value="">Choisir un bâtiment</option>
                <option *ngFor="let b of buildings" [value]="b.id">{{ b.name }} - {{ b.city }}</option>
              </select>
              <label for="buildingId" class="label">
                <i class="fas fa-home"></i>
                Bâtiment <span class="required">*</span>
              </label>
            </div>
            <div class="error" *ngIf="errors.buildingId">
              <i class="fas fa-exclamation-circle"></i> {{ errors.buildingId }}
            </div>
          </div>

          <div class="form-group" *ngIf="form.buildingId">
            <div class="input-container">
              <select id="apartmentId" [(ngModel)]="form.apartmentId" name="apartmentId" class="underline-input" required>
                <option value="">Choisir un appartement</option>
                <option *ngFor="let apt of filteredApartments" [value]="apt.id">
                  {{ apt.name }} - {{ apt.type }} - {{ apt.mention ? (apt.mention | number) + ' FCFA' : '-' }}
                </option>
              </select>
              <label for="apartmentId" class="label">
                <i class="fas fa-door-open"></i>
                Appartement <span class="required">*</span>
              </label>
            </div>
            <div class="error" *ngIf="errors.apartmentId">
              <i class="fas fa-exclamation-circle"></i> {{ errors.apartmentId }}
            </div>
          </div>
        </div>
      </div>

      <!-- Section personne affiliée -->
      <!-- Toggle Personne affiliée -->
      <div class="affiliation-toggle-section" style="margin: 24px 0; display: flex; align-items: center; justify-content: space-between;">
        <span style="font-weight: 500;">Personne affiliée</span>
        <label class="switch">
          <input type="checkbox" [(ngModel)]="showAffiliated" name="showAffiliated" (change)="onShowAffiliatedChange()" />
          <span class="slider round"></span>
        </label>
      </div>

      <div class="affiliation-section" *ngIf="showAffiliated">
        <h6>Personne à contacter en cas d'urgence</h6>
        <div class="affiliation-grid">
          <div class="form-group">
            <input type="text" id="affiliatedPersonRelation" [(ngModel)]="form.affiliatedPerson.relation" name="affiliatedPersonRelation" class="underline-input" placeholder=" " required />
            <label for="affiliatedPersonRelation" class="label">Type de relation <span class="required">*</span></label>
            <div class="error" *ngIf="errors.affiliatedPersonRelation">{{ errors.affiliatedPersonRelation }}</div>
          </div>

          <div class="form-group">
            <input type="text" id="affiliatedPersonFullName" [(ngModel)]="form.affiliatedPerson.fullName" name="affiliatedPersonFullName" class="underline-input" placeholder=" " required />
            <label for="affiliatedPersonFullName" class="label">Nom complet <span class="required">*</span></label>
            <div class="error" *ngIf="errors.affiliatedPersonFullName">{{ errors.affiliatedPersonFullName }}</div>
          </div>

          <div class="form-group">
            <input type="text" id="affiliatedPersonPhone" [(ngModel)]="form.affiliatedPerson.phone" name="affiliatedPersonPhone" class="underline-input" placeholder=" " required />
            <label for="affiliatedPersonPhone" class="label">Téléphone <span class="required">*</span></label>
            <div class="error" *ngIf="errors.affiliatedPersonPhone">{{ errors.affiliatedPersonPhone }}</div>
          </div>

          <div class="form-group">
            <input type="text" id="affiliatedPersonAddress" [(ngModel)]="form.affiliatedPerson.address" name="affiliatedPersonAddress" class="underline-input" placeholder=" " required />
            <label for="affiliatedPersonAddress" class="label">Adresse <span class="required">*</span></label>
            <div class="error" *ngIf="errors.affiliatedPersonAddress">{{ errors.affiliatedPersonAddress }}</div>
          </div>

          <div class="form-group">
            <input type="email" id="affiliatedPersonEmail" [(ngModel)]="form.affiliatedPerson.email" name="affiliatedPersonEmail" class="underline-input" placeholder=" " />
            <label for="affiliatedPersonEmail" class="label">Email</label>
            <div class="error" *ngIf="errors.affiliatedPersonEmail">{{ errors.affiliatedPersonEmail }}</div>
          </div>

          <div class="form-group">
            <input type="text" id="affiliatedPersonProfession" [(ngModel)]="form.affiliatedPerson.profession" name="affiliatedPersonProfession" class="underline-input" placeholder=" " />
            <label for="affiliatedPersonProfession" class="label">Profession</label>
            <div class="error" *ngIf="errors.affiliatedPersonProfession">{{ errors.affiliatedPersonProfession }}</div>
          </div>
        </div>
      </div>
    </div>
  </form>

  <!-- Affichage lecture du locataire -->
  <div *ngIf="!editMode" class="form-card">
    <div class="card-header">
      <h5>Informations du locataire</h5>
      <div class="action-buttons">
        <button class="action-btn edit" (click)="enableEdit()" title="Modifier les informations">
          <i class="fas fa-edit"></i>
        </button>
        <button class="action-btn delete" title="Supprimer le locataire" (click)="showDeleteConfirm = true">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>

    <div class="tenant-view-content">
      <!-- Photo et informations personnelles -->
      <div class="tenant-profile-section">
        <div class="tenant-photo-display">
          <div class="tenant-photo-container">
            <img *ngIf="tenant?.identityImage" [src]="tenant?.identityImage" alt="Photo d'identité" class="tenant-photo" />
            <div *ngIf="!tenant?.identityImage" class="tenant-avatar">
              <i class="fas fa-user"></i>
            </div>
          </div>
            <div class="tenant-status">
            <span class="status-badge status-active" *ngIf="getCurrentApartmentId(tenant)">Locataire actif</span>
            <span class="status-badge status-completed" *ngIf="!getCurrentApartmentId(tenant)">Ancien locataire</span>
          </div>
        </div>

        <div class="tenant-info-display">
          <div class="info-item">
            <label><i class="fas fa-user"></i> Nom complet</label>
            <p class="info-value">{{ tenant?.fullName || '-' }}</p>
          </div>
          <div class="info-item">
            <label><i class="fas fa-globe"></i> Pays</label>
            <p class="info-value">{{ tenant?.country || '-' }}</p>
          </div>
          <div class="info-item">
            <label><i class="fas fa-phone"></i> Téléphone</label>
            <p class="info-value">{{ tenant?.phone || '-' }}</p>
          </div>
          <div class="info-item">
            <label><i class="fas fa-exclamation-circle"></i> Contact urgence</label>
            <p class="info-value">{{ tenant?.emergencyContact || '-' }}</p>
          </div>
          <div class="info-item">
            <label><i class="fas fa-envelope"></i> Email</label>
            <p class="info-value">{{ tenant?.email || '-' }}</p>
          </div>
          <div class="info-item">
            <label><i class="fas fa-briefcase"></i> Profession</label>
            <p class="info-value">{{ tenant?.profession || '-' }}</p>
          </div>
          <div class="info-item">
            <label><i class="fas fa-briefcase"></i> Situation matrimoniale</label>
            <p class="info-value">{{ tenant?.maritalStatus || '-' }}</p>
          </div>
        </div>
      </div>

      <!-- Localisation actuelle (bâtiment • appartement • adresse sur la même ligne) -->
      <div class="location-section" *ngIf="getCurrentApartmentId(tenant)">
        <h6>Localisation actuelle</h6>
        <div class="location-inline">
          <ng-container *ngIf="getCurrentLocationParts(tenant) as loc">
            <span class="loc-part">{{ loc.buildingName }}</span>
            <span class="loc-sep">•</span>
            <span class="loc-part">{{ loc.apartmentName }}</span>
            <span class="loc-sep">•</span>
            <span class="loc-part">{{ loc.address }}</span>
          </ng-container>
        </div>
      </div>
      <!-- Section personne affiliée -->
  <div class="affiliation-section" *ngIf="tenant?.affiliatedPerson?.fullName">
        <h6>Personne à contacter en cas d'urgence</h6>
        <div class="affiliation-info">
          <div class="info-item">
            <label>Nom complet</label>
            <p class="info-value">{{ tenant?.affiliatedPerson?.fullName || '-' }}</p>
          </div>
          <div class="info-item">
            <label>Type de relation</label>
            <p class="info-value">{{ tenant?.affiliatedPerson?.relation || '-' }}</p>
          </div>
          <div class="info-item">
            <label>Téléphone</label>
            <p class="info-value">{{ tenant?.affiliatedPerson?.phone || '-' }}</p>
          </div>
          <div class="info-item">
            <label>Adresse</label>
            <p class="info-value">{{ tenant?.affiliatedPerson?.address || '-' }}</p>
          </div>
          <div class="info-item" *ngIf="tenant?.affiliatedPerson?.email">
            <label>Email</label>
            <p class="info-value">{{ tenant?.affiliatedPerson?.email || '-' }}</p>
          </div>
          <div class="info-item" *ngIf="tenant?.affiliatedPerson?.profession">
            <label>Profession</label>
            <p class="info-value">{{ tenant?.affiliatedPerson?.profession || '-' }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Historique des locations -->
  <div class="form-card">
    <div class="card-header">
      <h5>Historique des locations</h5>
    </div>
    
    <div class="table-container" *ngIf="rentalDetails.length > 0">
      <table class="data-table">
        <thead>
          <tr>
            <th>Appartement</th>
            <th>Propriétaire</th>
            <th>Date début</th>
            <th>Loyer</th>
            <th>Date fin</th>
            <th>Montant recouvré</th>
            <th>Quartier</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let detail of rentalDetails">
            <td>
              <strong>{{ detail.apartment?.name || '-' }}</strong>
              <div class="apartment-type">{{ detail.apartment?.type || '-' }}</div>
            </td>
            <td>{{ detail.owner?.name || '-' }}</td>
            <td>{{ detail.rental?.startDate ? (detail.rental?.startDate | date:'dd/MM/yyyy') : '-' }}</td>
            <td class="rent-amount">{{ detail.rental?.price ? (detail.rental?.price | number) + ' FCFA' : '-' }}</td>
            <td>{{ detail.rental?.endDate ? (detail.rental?.endDate | date:'dd/MM/yyyy') : '-' }}</td>
            <td class="recovered-amount">{{ detail.recoveredAmount ? (detail.recoveredAmount | number) + ' FCFA' : '-' }}</td>
            <td>{{ detail.apartment?.region || '-' }}</td>
            <td>
              <span class="status-badge" [ngClass]="{
                'status-active': isRentalActive(detail.rental),
                'status-completed': !isRentalActive(detail.rental),
                'status-cancelled': detail.rental?.status === 'cancelled'
              }">
                <span *ngIf="detail.rental?.status === 'cancelled'">
                  {{ getCancellationTypeLabel(detail.rental?.cancellationType) }}
                </span>
                <span *ngIf="detail.rental?.status !== 'cancelled'">
                  {{ isRentalActive(detail.rental) ? 'Active' : 'Terminée' }}
                </span>
              </span>
            </td>
            <td>
              <button 
                *ngIf="isRentalActive(detail.rental)" 
                class="btn btn-sm btn-danger" 
                (click)="openAbandonmentModal(detail.rental!)" 
                title="Abandonner la location">
                <i class="fas fa-times"></i> Abandonner
              </button>
              <span *ngIf="!isRentalActive(detail.rental)" class="text-muted">-</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="rentalDetails.length === 0" class="no-data">
      <div class="no-data-content">
        <i class="fas fa-home"></i>
        <h6>Aucun historique de location</h6>
        <p>Ce locataire n'a pas encore d'historique de location.</p>
      </div>
    </div>
  </div>

  <!-- Section Documents complémentaires -->
  <div class="form-card">
    <div class="card-header">
      <h5>Documents complémentaires</h5>
      <div class="action-buttons">
        <button class="action-btn add" (click)="openDocumentUploadModal()" title="Ajouter un document">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <!-- Liste des documents requis -->
    <div class="documents-section">
      <div class="documents-checklist">
        <h6>Liste des documents à fournir</h6>
        <div class="documents-list">
          <div *ngFor="let docType of requiredDocuments" class="document-item" [class.required]="docType.required" [class.completed]="hasDocumentType(docType.type)">
            <div class="document-checkbox">
              <i *ngIf="hasDocumentType(docType.type)" class="fas fa-check-circle check-icon"></i>
              <i *ngIf="!hasDocumentType(docType.type)" class="far fa-circle empty-icon"></i>
            </div>
            <div class="document-info">
              <span class="document-label">
                <i class="fas" [ngClass]="docType.icon"></i>
                {{ docType.label }}
              </span>
              <span *ngIf="docType.required" class="required-badge">Requis</span>
            </div>
            <div class="document-actions">
              <button 
                class="btn-icon btn-primary sm" 
                (click)="openDocumentUploadModal(docType.type)"
                title="Ajouter ce document">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Documents téléchargés -->
      <div class="documents-uploaded" *ngIf="tenantDocuments.length > 0">
        <h6>Documents téléchargés</h6>
        <div class="documents-grid">
          <div *ngFor="let document of tenantDocuments" class="document-card">
            <div class="document-card-header">
              <div class="document-icon">
                <i class="fas" [ngClass]="getDocumentIcon(document.type)"></i>
              </div>
              <div class="document-status">
                <span class="status-badge" [ngClass]="{
                  'status-pending': document.status === 'pending',
                  'status-approved': document.status === 'approved',
                  'status-rejected': document.status === 'rejected'
                }">
                  {{ getDocumentStatusLabel(document.status) }}
                </span>
              </div>
            </div>
            <div class="document-card-body">
              <h6 class="document-name">{{ document.name }}</h6>
              <p class="document-meta">
                <i class="fas fa-file"></i>
                {{ document.fileName }}
              </p>
              <p class="document-meta">
                <i class="fas fa-weight"></i>
                {{ formatFileSize(document.fileSize) }}
              </p>
              <p class="document-meta" *ngIf="document.uploadedAt">
                <i class="fas fa-calendar"></i>
                {{ document.uploadedAt | date:'dd/MM/yyyy' }}
              </p>
              <p class="document-notes" *ngIf="document.notes">
                <i class="fas fa-comment"></i>
                {{ document.notes }}
              </p>
            </div>
            <div class="document-card-actions" style="position: relative;">
              <button class="btn-icon btn-menu sm" (click)="toggleDocumentMenu(document)" title="Actions document">
                <i class="fas fa-ellipsis-h"></i>
              </button>
              <div class="document-menu-dropdown" *ngIf="isDocumentMenuOpen(document)" (mouseleave)="closeDocumentMenu()">
                <button (click)="viewDocument(document); closeDocumentMenu()"><i class="fas fa-eye"></i> Voir</button>
                <button (click)="downloadDocument(document); closeDocumentMenu()"><i class="fas fa-download"></i> Télécharger</button>
                <button (click)="openDocumentUploadModal(document.type, document); closeDocumentMenu()"><i class="fas fa-edit"></i> Modifier</button>
                <button (click)="deleteDocument(document.id); closeDocumentMenu()"><i class="fas fa-trash"></i> Supprimer</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Message si aucun document -->
      <div *ngIf="tenantDocuments.length === 0" class="no-documents">
        <div class="no-documents-content">
          <i class="fas fa-folder-open"></i>
          <h6>Aucun document téléchargé</h6>
          <p>Commencez par ajouter les documents requis pour compléter le dossier du locataire.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modale d'upload de document -->
<div *ngIf="showDocumentUploadModal" class="modal-overlay" (click)="closeDocumentUploadModal()">
    <div class="modal-card large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h5>{{ selectedDocumentBeingEdited ? 'Modifier le document' : 'Ajouter un document' }}</h5>
      <button class="modal-close" (click)="closeDocumentUploadModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="form-group">
        <label for="documentType">Type de document <span class="required">*</span></label>
        <select 
          id="documentType" 
          [(ngModel)]="selectedDocumentType" 
          name="documentType" 
          class="form-control"
          required>
          <option value="">Sélectionner un type de document</option>
          <option *ngFor="let docType of requiredDocuments" [value]="docType.type">
            {{ docType.label }}
          </option>
        </select>
        <div class="error" *ngIf="errors.documentType">
          <i class="fas fa-exclamation-circle"></i> {{ errors.documentType }}
        </div>
      </div>

      <div class="form-group">
        <label for="documentFile">Fichier <span class="required">*</span></label>
        <input 
          type="file" 
          id="documentFile" 
          (change)="onDocumentFileSelected($event)" 
          class="form-control"
          accept=".pdf,.jpg,.jpeg,.png,.webp,.doc,.docx"
          required />
        <div class="file-info" *ngIf="documentFile">
          <i class="fas fa-file"></i>
          <span>{{ documentName }}</span>
          <span class="file-size">({{ formatFileSize(documentFile.size) }})</span>
        </div>
        <div class="error" *ngIf="errors.documentFile">
          <i class="fas fa-exclamation-circle"></i> {{ errors.documentFile }}
        </div>
        <small class="form-text text-muted">
          Formats acceptés: PDF, JPEG, PNG, WebP, Word. Taille maximum: 10MB
        </small>
      </div>

      <div class="form-group">
        <label for="documentNotes">Notes (optionnel)</label>
        <textarea 
          id="documentNotes" 
          [(ngModel)]="documentNotes" 
          name="documentNotes" 
          class="form-control" 
          rows="3"
          placeholder="Ajoutez des notes ou des commentaires sur ce document..."></textarea>
      </div>

      <div class="error" *ngIf="errors.general">
        <i class="fas fa-exclamation-circle"></i> {{ errors.general }}
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-light" (click)="closeDocumentUploadModal()" [disabled]="uploadingDocument">
        Annuler
      </button>
      <button 
        type="button" 
        class="btn btn-primary" 
        (click)="uploadDocument()" 
        [disabled]="uploadingDocument || !selectedDocumentType || !documentFile">
        <i class="fas fa-upload" *ngIf="!uploadingDocument"></i>
        <i class="fas fa-spinner fa-spin" *ngIf="uploadingDocument"></i>
        {{ uploadingDocument ? 'Téléchargement...' : 'Télécharger' }}
      </button>
    </div>
  </div>
</div>