<div class="page-container">
  <div class="page-header">
    <button class="btn btn-light back-btn" (click)="cancel()">
      <i class="fas fa-arrow-left"></i> Locataires
    </button>
    <h4 class="page-title">Créer un locataire</h4>
  </div>

  <div class="content-container">
    <form (ngSubmit)="create()" class="form-card">
    <!-- Informations personnelles -->
    <section class="form-section">
      <div class="section-header">
        <i class="fas fa-user-circle section-icon"></i>
        <h2>Informations personnelles</h2>
      </div>
      
      <div class="tenant-grid">
        <!-- Photo d'identité -->
        <div class="form-group photo-upload-container">
          <div class="photo-preview" *ngIf="!previewImage">
            <i class="fas fa-camera photo-placeholder"></i>
          </div>
          <div class="photo-preview" *ngIf="previewImage">
            <img [src]="previewImage" alt="Aperçu photo" class="photo-preview-img">
          </div>
          <input type="file" id="identityImage" accept="image/*" name="identityImage" 
                 class="tenant-photo-container" (change)="onImageSelect($event)" />
          <label for="identityImage" class="photo-upload-label">
            <i class="fas fa-cloud-upload-alt"></i>
            Photo d'identité <span class="required">*</span>
          </label>
          <div class="error" *ngIf="errors.identityImage">{{ errors.identityImage }}</div>
        </div>

        <!-- Informations de base -->
        <div class="form-group">
          <div class="input-container">
            <input type="text" id="fullName" [(ngModel)]="form.fullName" name="fullName" 
                   class="underline-input" required placeholder=" " />
            <label for="fullName" class="label">
              <i class="fas fa-user input-icon"></i>
              Nom complet <span class="required">*</span>
            </label>
          </div>
          <div class="error" *ngIf="errors.fullName">{{ errors.fullName }}</div>
        </div>

        <div class="form-group">
          <div class="input-container">
            <input type="text" id="country" [(ngModel)]="form.country" name="country" 
                   class="underline-input" required placeholder=" " autocomplete="off" />
            <label for="country" class="label">
              <i class="fas fa-globe input-icon"></i>
              Pays <span class="required">*</span>
            </label>
          </div>
          <div class="error" *ngIf="errors.country">{{ errors.country }}</div>
        </div>

        <div class="form-group">
          <div class="input-container">
            <input type="text" id="address" [(ngModel)]="form.address" name="address" 
                   class="underline-input" required placeholder=" " />
            <label for="address" class="label">
              <i class="fas fa-map-marker-alt input-icon"></i>
              Adresse <span class="required">*</span>
            </label>
          </div>
          <div class="error" *ngIf="errors.address">{{ errors.address }}</div>
        </div>

        <div class="form-group">
          <div class="input-container">
            <input type="text" id="phone" [(ngModel)]="form.phone" name="phone" 
                   class="underline-input" required placeholder=" " />
            <label for="phone" class="label">
              <i class="fas fa-phone input-icon"></i>
              Téléphone <span class="required">*</span>
            </label>
          </div>
          <div class="error" *ngIf="errors.phone">{{ errors.phone }}</div>
        </div>

        <div class="form-group">
          <div class="input-container">
            <input type="email" id="email" [(ngModel)]="form.email" name="email" 
                   class="underline-input" required placeholder=" " />
            <label for="email" class="label">
              <i class="fas fa-envelope input-icon"></i>
              Email <span class="required">*</span>
            </label>
          </div>
          <div class="error" *ngIf="errors.email">{{ errors.email }}</div>
        </div>

        <div class="form-group">
          <div class="input-container">
            <input type="text" id="profession" [(ngModel)]="form.profession" name="profession" 
                   class="underline-input" placeholder=" " autocomplete="off" />
            <label for="profession" class="label">
              <i class="fas fa-briefcase input-icon"></i>
              Profession
            </label>
          </div>
        </div>
      </div>

      <!-- Deuxième ligne d'informations -->
      <div class="tenant-grid">
        <div class="form-group">
          <div class="input-container">
            <select id="identityType" [(ngModel)]="form.identityType" name="identityType" 
                    class="underline-input" required>
              <option value=""></option>
              <option value="CNI">Carte Nationale d'Identité</option>
              <option value="Passeport">Passeport</option>
              <option value="Permis">Permis de conduire</option>
              <option value="Autre">Autre</option>
            </select>
            <label for="identityType" class="label">
              <i class="fas fa-id-badge input-icon"></i>
              Type de pièce d'identité <span class="required">*</span>
            </label>
          </div>
          <div class="error" *ngIf="errors.identityType">{{ errors.identityType }}</div>
        </div>

        <div class="form-group">
          <div class="input-container">
            <input type="text" id="identityNumber" [(ngModel)]="form.identityNumber" name="identityNumber" 
                   class="underline-input" required placeholder=" " />
            <label for="identityNumber" class="label">
              <i class="fas fa-hashtag input-icon"></i>
              Numéro de pièce d'identité <span class="required">*</span>
            </label>
          </div>
          <div class="error" *ngIf="errors.identityNumber">{{ errors.identityNumber }}</div>
        </div>

        <div class="form-group">
          <div class="input-container">
            <select id="maritalStatus" [(ngModel)]="form.maritalStatus" name="maritalStatus" 
                    class="underline-input">
              <option value=""></option>
              <option value="Célibataire">Célibataire</option>
              <option value="Marié(e)">Marié(e)</option>
              <option value="Divorcé(e)">Divorcé(e)</option>
              <option value="Veuf(ve)">Veuf(ve)</option>
            </select>
            <label for="maritalStatus" class="label">
              <i class="fas fa-heart input-icon"></i>
              Situation matrimoniale <span class="required">*</span>
            </label>
          </div>
          <div class="error" *ngIf="errors.maritalStatus">{{ errors.maritalStatus }}</div>
        </div>

        <div class="form-group">
          <div class="input-container">
            <input type="text" id="emergencyContact" [(ngModel)]="form.emergencyContact" name="emergencyContact" 
                   class="underline-input" placeholder=" " />
            <label for="emergencyContact" class="label">
              <i class="fas fa-phone input-icon"></i>
              Contact d'urgence <span class="required">*</span>
            </label>
          </div>
          <div class="error" *ngIf="errors.emergencyContact">{{ errors.emergencyContact }}</div>
        </div>

        <div class="form-group">
          <div class="input-container">
            <input type="text" id="rentalType" [(ngModel)]="form.rentalType" name="rentalType" 
                   class="underline-input" placeholder=" " />
            <label for="rentalType" class="label">
              <i class="fas fa-home input-icon"></i>
              Type de logement loué <span class="required">*</span>
            </label>
          </div>
          <div class="error" *ngIf="errors.rentalType">{{ errors.rentalType }}</div>
        </div>
      </div>
    </section>

    <!-- Personne affiliée -->
    <section class="form-section">
      <div class="affiliation-toggle-section">
        <div class="toggle-content">
          <i class="fas fa-users toggle-icon"></i>
          <div class="toggle-text">
            <h3>Personne affiliée</h3>
            <p>Ajouter une personne affiliée au locataire</p>
          </div>
        </div>
        <label class="switch">
          <input type="checkbox" [(ngModel)]="showAffiliated" name="showAffiliated" />
          <span class="slider round"></span>
        </label>
      </div>

      <div class="affiliation-section" *ngIf="showAffiliated">
        <div class="affiliated-card">
          <div class="tenant-grid">
            <div class="form-group">
              <div class="input-container">
                <input type="text" id="affiliatedPersonRelation" [(ngModel)]="form.affiliatedPerson.relation" 
                       name="affiliatedPersonRelation" class="underline-input" placeholder=" " />
                <label for="affiliatedPersonRelation" class="label">
                  Type de relation <span class="required">*</span>
                </label>
              </div>
              <div class="error" *ngIf="errors.affiliatedPersonRelation">{{ errors.affiliatedPersonRelation }}</div>
            </div>

            <div class="form-group">
              <div class="input-container">
                <input type="text" id="affiliatedPersonFullName" [(ngModel)]="form.affiliatedPerson.fullName" 
                       name="affiliatedPersonFullName" class="underline-input" placeholder=" " />
                <label for="affiliatedPersonFullName" class="label">
                  Prénom et nom <span class="required">*</span>
                </label>
              </div>
              <div class="error" *ngIf="errors.affiliatedPersonFullName">{{ errors.affiliatedPersonFullName }}</div>
            </div>

            <div class="form-group">
              <div class="input-container">
                <input type="text" id="affiliatedPersonPhone" [(ngModel)]="form.affiliatedPerson.phone" 
                       name="affiliatedPersonPhone" class="underline-input" placeholder=" " />
                <label for="affiliatedPersonPhone" class="label">
                  Téléphone <span class="required">*</span>
                </label>
              </div>
              <div class="error" *ngIf="errors.affiliatedPersonPhone">{{ errors.affiliatedPersonPhone }}</div>
            </div>

            <div class="form-group">
              <div class="input-container">
                <input type="text" id="affiliatedPersonAddress" [(ngModel)]="form.affiliatedPerson.address" 
                       name="affiliatedPersonAddress" class="underline-input" placeholder=" " />
                <label for="affiliatedPersonAddress" class="label">
                  Adresse <span class="required">*</span>
                </label>
              </div>
              <div class="error" *ngIf="errors.affiliatedPersonAddress">{{ errors.affiliatedPersonAddress }}</div>
            </div>

            <div class="form-group">
              <div class="input-container">
                <input type="email" id="affiliatedPersonEmail" [(ngModel)]="form.affiliatedPerson.email" 
                       name="affiliatedPersonEmail" class="underline-input" placeholder=" " />
                <label for="affiliatedPersonEmail" class="label">E-mail</label>
              </div>
              <div class="error" *ngIf="errors.affiliatedPersonEmail">{{ errors.affiliatedPersonEmail }}</div>
            </div>

            <div class="form-group">
              <div class="input-container">
                <input type="text" id="affiliatedPersonProfession" [(ngModel)]="form.affiliatedPerson.profession" 
                       name="affiliatedPersonProfession" class="underline-input" placeholder=" " />
                <label for="affiliatedPersonProfession" class="label">Profession</label>
              </div>
              <div class="error" *ngIf="errors.affiliatedPersonProfession">{{ errors.affiliatedPersonProfession }}</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Sélection du logement -->
    <section class="form-section">
      <div class="section-header">
        <i class="fas fa-building section-icon"></i>
        <h2>Informations du logement</h2>
      </div>

      <div class="housing-grid">
        <div class="form-group">
          <div class="input-container">
            <select id="buildingId" [(ngModel)]="form.buildingId" name="buildingId" 
                    class="underline-input" (change)="onBuildingChange()">
              <option value="" disabled selected></option>
              <option *ngFor="let b of buildings" [value]="b.id">{{ b.name }}</option>
            </select>
            <label for="buildingId" class="label">
              <i class="fas fa-city input-icon"></i>
              Bâtiment <span class="required">*</span>
            </label>
          </div>
        </div>

        <div class="form-group" *ngIf="form.buildingId">
          <div class="input-container">
            <select id="apartments" [(ngModel)]="form.apartments" name="apartments" 
                    class="underline-input" multiple>
              <option *ngFor="let apt of filteredApartments" [value]="apt.id">
                {{ apt.name }} - {{ apt.address }}
              </option>
            </select>
            <label for="apartments" class="label">
              <i class="fas fa-door-open input-icon"></i>
              Appartements à louer (optionnel)
            </label>
          </div>
          <div class="select-hint">Maintenez Ctrl pour sélectionner plusieurs appartements</div>
        </div>
      </div>
    </section>

    <!-- Actions -->
  </form>
  </div>
</div>
    <div class="action-bar">
      <div class="form-actions">
        <button type="button" class="btn btn-light" (click)="cancel()">
          <i class="fas fa-times"></i>
          Annuler
        </button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-plus"></i>
          Créer le locataire
        </button>
      </div>
    </div>